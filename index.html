<!DOCTYPE html>
<html>
<script
  src="https://code.jquery.com/jquery-3.4.1.min.js"
  integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo="
  crossorigin="anonymous"></script>
 
<body>


    <div>
        <div>
            xpath
            <textarea rows="20" id='xpath' cols="50" placeholder="xpath"></textarea>
            class
            <textarea id='code' rows="20" cols="50"></textarea>
        </div>
        <button onClick="loopObjects()">Loop</button>
        <button onClick="getObject()">getObject()</button>
        <button onClick="Build()">Build</button>
        <button onClick="WrapToBrackets()">WrapToBrackets</button>
        <button onClick='duplicateSymbol("\"")'>duplicateQ</button>
        <button onClick='escapeQuotationmarks()'>EscapeQMarks</button>
        <button onClick='duplicateSymbol("}",duplicateSymbol("{"))'>duplicateSymbol{}</button>
        <button onClick="Cert()">Cert</button>
        <button onClick="buildAddress()">Build Add</button>
        <button onClick="buildHeaders()">Headers</button>
        <button onClick="replaceArrows()">replaceArrows</button>
        <input id="className" value="Test1" />
        <input id="modelName" value="mod" />
        <input id="position" value="data[0]" />
        FirstLetterUp <input type="checkbox" id="toUpper" />
        No examples<input type="checkbox" checked id="noExamples" />
    </div>

<div>
    <textarea id='res' rows="130" cols="100" placeholder="3"></textarea>
</div>


<style>


</style>
<script>
    var js = {};
    var step = 0;
    var obj = {};
    var steps = [];

    function saveInputs() {
        
        var json = xpath = $("#xpath").val();
        localStorage.setItem("json", json);
          localStorage.setItem("modelName", $("#modelName").val());
        localStorage.setItem("className", $("#className").val());
         localStorage.setItem("position", $("#position").val());
    }


    function getObject() {

        //if (step == 0)
        
        var json = xpath = $("#xpath").val();
        saveInputs();

        //localStorage.setItem("lastname", "Smith");
        obj = JSON.parse(json);
        var position = $("#position").val();
        console.log(position);
        if (position.indexOf("►")>-1) {
            position = position.replace(/►/g, '.');
            $("#position").val(position);
        }
        if (position.length < 2)
            return obj;
        position = position.replace(/\[|\]|\./g, ' ');
            position = position.trim();
         steps = position.split(' ');
        
        //obj = obj[steps[step++]];
        console.log(steps.length);
        for (var i = 0; i < steps.length; i++) {
            console.log(steps[i])
            var hz = obj[steps[i]];
            //console.log(hz.length);
            obj = hz;
            $("#res").val(JSON.stringify(obj));
        }
            //$("#position").val(position);
        return obj;
    }


    function loopObjects() {

        var obj = getObject();
        var text = "";
        Object.keys(obj).forEach(function (key, index) {

            text += key + '\n';
         });
              $("#code").val(text);
    }

  
    function Build() {

        var xpath = $("#xpath").val();
        //js = JSON.parse(xpath);
        var obj = getObject();
       
            var className = $("#className").val();
        var modelName = $("#modelName").val();
        var parsingCode = 'var ' + modelName + '=new ' + className + '(); \n';
        var noExamples = !$("#noExamples").is(':checked');
        var toUpper = $("#toUpper").is(':checked');
        var cClass = "public class " + className + "{\n";
       
        Object.keys(obj).forEach(function (key, index) {
            var propertyName = key;
            if (toUpper) {
               propertyName=key.charAt(0).toUpperCase() + key.slice(1)
            }
          
            var type = Object.prototype.toString.call(obj[key]);
            var propertyCode = "";
            if (noExamples)
                propertyCode = '//' + propertyName + ' ' + obj[key] + '\n';
            propertyCode += "public ";
            var jsObjParseCode = 'jsObj["' + key + '"]?.ToString()';
            var parseCode = modelName+"." + propertyName + "=";
            //string BillofLadingNo { get; set; } '
            if (type === "[object Number]") {
                propertyCode += 'double ';
                parseCode = parseCode + 'double.Parse(' + jsObjParseCode + ')';
            }
            else if (type === "[object Boolean]") {
                propertyCode += 'bool ';
                  parseCode = parseCode + 'bool.Parse(' + jsObjParseCode + ')';
            }
            else {
                 if (type === "[object String]") {
                propertyCode += 'string ';
            }
            else
                    propertyCode += 'string array_____';
                parseCode = parseCode + jsObjParseCode;


            }
            parseCode += ";\n";
            propertyCode +=propertyName+ '{ get; set; } \n';
            console.log(key + " " + obj[key] + " " + Object.prototype.toString.call(obj[key]));
            cClass += propertyCode;
            parsingCode += parseCode;
        });
        cClass += "}";
        parsingCode += 'list.Add(' + modelName + ');';
         //-----------------
         var parseWay = "var arr=(JArray)obj";
        var position = $("#position").val().replace(/\[|\]|\./g, ' ');
        steps = position.split(' ');
        
        //obj = obj[steps[step++]];
        console.log(steps.length);
        for (var i = 0; i < steps.length-1; i++) {
            
            parseWay += '["'+steps[i] + '"]';
            
        }
        //-----------------
        parsingCode = 'var list=new List<' + className+'>();\n'+ parseWay + ';\nforeach(var jsObj in arr){\n' + parsingCode + '\n}\n';


        $("#res").val(cClass);
        $("#code").val(parsingCode);
          //$("#res").val(JSON.stringify(js.data[0]) );
        return;
        var code = $("#code").val();
        var xpathList = xpath.split('\n');
        var codeListTemp = code.split('\n');
        var res = "";
        var codeList = [];
        for (var i = 0; i < codeListTemp.length; i++) {
            code = codeListTemp[i];
            if (code.length < 3)
                continue;
            var token = 'string ';
            var begin = code.indexOf(token);
            var end = code.indexOf('{');
            code = code.substring(begin + token.length, end);
            //res += code + "\n";
            codeList.push(code);
        }


        for (var i = 0; i < xpathList.length; i++) {
            xpath = xpathList[i].replace(/"/g, "'");
            res += 'mod.' + codeList[i]+'=doc.SelectSingleNode("' +xpath +'")?.InnerText;\n';
        }
        //res = code.replace(/\s{2,}/g, ' ');
        $("#res").val(res);
    }

    function WrapToBrackets() {

        var text = $("#xpath").val();
        var res ='' ;
        text = text.split('\n')[0].split('►');
        for (var i = 0; i < text.length; i++) {

            res += '["' + text[i] + '"]';
        }
        res+='.ToString();'
         $("#res").val(res);

    }
    function buildAddress() {
        //getObject();
        console.log("build add");
        var text = $("#xpath").val();
        var res = 'string adr = "";\nstring temp = null;';
        var cmn = 'if (!string.IsNullOrEmpty(temp))\n{\nadr += ", " + temp;\n}\n';
                        
                    
        text = text.split('\n');
        for (var i = 0; i < text.length; i++) {

            res += 'temp=' + text[i].split('=')[1] + '\n';
            res += cmn;
        }
     
         $("#res").val(res);

    }

    function buildHeaders() {
        saveInputs();
        var res ='private static WebHeaderCollection GetHeads() {\n'+
            'var heads = new WebHeaderCollection();\n';
        var text = $("#xpath").val();
        
        text = text.split('\n');
        for (var i = 0; i < text.length; i++) {
            var parts = text[i].split(':');
            if (parts.length < 2)
                continue;


            res += 'heads.Add("' + parts[0].trim() + '","' + text[i].substring(parts[0].length+1).trim() + '");\n';
        }
        res += 'return heads;\n}';
         $("#res").val(res);
    }

    function replaceArrows(symbol, text) {
         saveInputs();
        var res ='';
        var text = $("#xpath").val();
          var regex = new RegExp("/►/g", 'g');
        text = text.replace(/►/g, '"]["');
        text = text.replace(/\n/g, '' );
        text = text.replace(/^("|])+/g, '');
        text = text.replace(/("|\[)+$/g, '' );
        var abc = '';
        for (var i = 0; i < text.length; i++) {
            abc = abc + text.charCodeAt(i)+" "+ text[i] + "\n";

        }

        text = text.replace(/f+$/g, '' );
        $("#res").val(text);
        //$("#res").val(abc);
        return text;

    }
    

    function duplicateSymbol(symbol,text) {

        if (typeof text === 'undefined')
        text = $("#xpath").val();
        var regex = new RegExp(symbol, 'g');
        text = text.replace(regex, symbol + symbol);
      //text= text.replace(/"/g, '""');
        $("#res").val(text);
        return text;

    }
	    function escapeQuotationmarks() {

        //if (typeof text === 'undefined')
		console.log('h');
        var text = $("#xpath").val();
        var regex = new RegExp("\"", 'g');
        text = text.replace(regex, '\\"' );
      //text= text.replace(/"/g, '""');
        $("#res").val(text);
        return text;

    }
	
	
	function Cert()
	{
	const nn = String.raw`\n`;
	 var text = $("#xpath").val();
        var res ='' ;
        text = text.split('\n')
		
		for (var i = 0; i < text.length; i++) {

		
		//res+=zzz;
            res += '"' + text[i] + nn+'"\n';
        }
		  $("#res").val(res);
	}
	
  
    $("#xpath").val(localStorage.json);
    $("#modelName").val(localStorage.modelName);
    $("#className").val(localStorage.className);
    $("#position").val(localStorage.position);

    function setCookie(cname, cvalue) {
  var d = new Date();
  d.setTime(d.getTime() + (365*24*60*60*1000));
  var expires = "expires="+ d.toUTCString();
  document.cookie = cname + "=" + cvalue + ";" + expires + ";path=/";
    }
    function getCookie(cname) {
  var name = cname + "=";
  var decodedCookie = decodeURIComponent(document.cookie);
  var ca = decodedCookie.split(';');
  for(var i = 0; i <ca.length; i++) {
    var c = ca[i];
    while (c.charAt(0) == ' ') {
      c = c.substring(1);
    }
    if (c.indexOf(name) == 0) {
      return c.substring(name.length, c.length);
    }
  }
  return "";
}

</script> 

</body>
</html>